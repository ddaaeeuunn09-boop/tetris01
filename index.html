<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>바닐라 JS 테트리스</title>
    <style>
        /*
        ===================================================================
        CSS 스타일: 게임의 모양을 정의합니다.
        ===================================================================
        */
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: #2c3e50;
            color: #ecf0f1;
            font-family: Arial, sans-serif;
            padding-top: 20px;
        }

        .game-container {
            display: flex;
            gap: 20px;
        }

        /* 메인 게임 보드 (10칸 x 20줄) */
        .grid {
            width: 200px; 
            height: 400px; 
            display: flex;
            flex-wrap: wrap;
            border: 3px solid #f39c12;
            background-color: #34495e;
        }

        .grid div {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
            border: 1px solid #4a6781;
        }
        
        /* 바닥에 깔린 'taken' 셀 중, 보드 바닥(21번째 줄)의 스타일 */
        .grid .taken {
            background-color: #34495e; 
            border: none;
        }
        
        /* 블록이 쌓인 곳의 시각적 스타일 */
        .grid div.block {
            border: 2px outset #bdc3c7;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5) inset;
        }

        /* 다음 블록 패널 (4칸 x 4칸) */
        .next-block-area {
            background-color: #34495e;
            padding: 10px;
            border: 2px solid #2ecc71;
            text-align: center;
        }

        .next-grid {
            width: 80px; 
            height: 80px; 
            display: flex;
            flex-wrap: wrap;
            margin: 10px auto;
            border: 1px dashed #ecf0f1;
        }

        .next-grid div {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
        }

        /* 버튼 스타일 */
        .start-button {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
        }

        /* 테트로미노 색상 정의 */
        .l { background-color: orange; }
        .j { background-color: blue; }
        .i { background-color: cyan; }
        .o { background-color: yellow; }
        .s { background-color: limegreen; }
        .z { background-color: red; }
        .t { background-color: purple; }

    </style>
</head>
<body>

    <div class="game-container">
        <div class="grid">
        </div>

        <div class="side-panel">
            <div class="score-display">점수: 0</div>
            
            <div class="next-block-area">
                <h3>다음 블록</h3>
                <div class="next-grid">
                </div>
            </div>
            
            <button class="start-button">시작</button>
            
            <p style="font-size:0.9em; margin-top: 15px;">
                **조작법**<br>
                ← → : 이동<br>
                ↑ : 회전<br>
                ↓ : 소프트 드롭<br>
                Space : 하드 드롭
            </p>
        </div>
    </div>


    <script>
        /*
        ===================================================================
        JavaScript 로직 (제공해주신 코드를 기반으로 검토 및 최적화)
        ===================================================================
        */
        document.addEventListener('DOMContentLoaded', () => {
            // 1. 기본 설정
            const grid = document.querySelector('.grid');
            const nextGrid = document.querySelector('.next-grid');
            const scoreDisplay = document.querySelector('.score-display');
            const startButton = document.querySelector('.start-button');
            const width = 10; // 게임 보드 너비
            const nextWidth = 4; // 다음 블록 보드 너비
            let squares; // 메인 보드 셀 배열
            let nextSquares; // 다음 블록 보드 셀 배열
            let timerId; 
            let score = 0;
            let isGameOver = false;
            let isPaused = true;

            // 2. 게임 보드 초기화: 200개의 셀 (게임 영역) + 10개의 고스트 셀 (바닥)
            for (let i = 0; i < 210; i++) {
                const div = document.createElement('div');
                if (i >= 200) {
                    div.classList.add('taken'); 
                }
                grid.appendChild(div);
            }
            squares = Array.from(grid.querySelectorAll('div'));

            // 3. 다음 블록 보드 초기화
            for (let i = 0; i < 16; i++) {
                const div = document.createElement('div');
                nextGrid.appendChild(div);
            }
            nextSquares = Array.from(nextGrid.querySelectorAll('div'));


            // 4. 테트로미노(Tetrominoes) 모양 정의 (7가지 블록)
            // width는 10, nextWidth는 4로 설정되어 있습니다.
            const lTetromino = [
                [1, width + 1, width * 2 + 1, 2], 
                [width, width + 1, width + 2, width * 2 + 2], 
                [1, width + 1, width * 2 + 1, width * 2], 
                [width, width * 2, width * 2 + 1, width * 2 +
